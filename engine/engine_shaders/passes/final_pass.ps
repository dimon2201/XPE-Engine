#include ../tonemap.shader
#include ../camera.shader

struct VSOut
{
    float4 positionClip : SV_POSITION;
    float2 uv : XPE_UV;
};

struct PSOut
{
    float4 color : SV_Target0;
};

Texture2D<float4> SceneTexture : register(t0);
Texture2D<float4> AOTexture    : register(t1);
Texture2D<float4> UITexture    : register(t2);

PSOut ps_main(VSOut psIn)
{
    uint sceneWidth = 0;
    uint sceneHeight = 0;
    SceneTexture.GetDimensions(sceneWidth, sceneHeight);

    uint aoWidth = 0;
    uint aoHeight = 0;
    AOTexture.GetDimensions(aoWidth, aoHeight);

    uint uiWidth = 0;
    uint uiHeight = 0;
    UITexture.GetDimensions(uiWidth, uiHeight);

    float3 scene = SceneTexture.Load(int3(float2(sceneWidth, sceneHeight) * psIn.uv, 0)).xyz;
    scene = TonemapExp(scene, CameraExposure);
    float3 ao = AOTexture.Load(int3(float2(aoWidth, aoHeight) * psIn.uv, 0)).xyz;
    float3 ui = UITexture.Load(int3(float2(uiWidth, uiHeight) * psIn.uv, 0)).xyz;

    PSOut psOut;
    psOut.color = float4(scene, 1.0) * float4(ao, 1.0) + float4(ui, 1.0);

    return psOut;
}